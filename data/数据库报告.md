# 大作业报告

## 一、创建表和角色

### 1. 创建表

本项目数据库包含五个核心表，旨在全面、多维度地记录和分析县域的发展状况。所有业务表均通过外键关联到基础信息表 County，实现数据的标准化管理。

#### **（1）County 表 (基础信息表)**

**功能**: 存储所有被追踪县域的基础地理信息。作为所有业务数据的主键引用源。
**关键字段**:
county_id: 主键，唯一的县域标识符。
name: 县名称。
province: 所属省份。
**约束**: 确保县名和省份的组合是唯一的 (UNIQUE(name, province))，避免重复录入。

#### **（2） InfrastructureService 表 (基础设施服务)**

 **功能**: 记录各县域在特定年份的基础设施覆盖和建设情况，反映农村地区的现代化水平。
 **关键字段**:
  county_id &year: 关联县域和时间。
  pct_village_with_hard_road: 通硬化路行政村百分比。
  pct_village_with_electricity: 通电行政村百分比。
  broadband_coverage: 宽带覆盖率。
  sanitation_coverage: 卫生厕所覆盖率。

#### **（3）AgricultureSales 表 (农业销售数据)**

 **功能**: 记录各县域特定农产品的销售情况，用于评估当地特色农业产业的发展和经济贡献。
 **关键字段**:
  county_id &year: 关联县域和时间。
  product_type: 农产品类型（如：粮食、水果、畜牧产品）。
  sales_volume: 销售量。
  sales_value: 销售额。

#### **（4）CountyEconomy 表 (县域经济发展)**

 **功能**: 记录县域宏观经济指标，是评估经济发展水平的核心数据。
 **关键字段**:
  county_id &year: 关联县域和时间。
  gdp_total: 年 GDP (亿元)。
  fiscal_revenue: 财政收入 (亿元)。
  per_capita_income: 全体居民人均可支配收入 (元)。
 约束: 县域和年份的组合是唯一的 (UNIQUE KEY uk_county_year)，确保每年只有一个经济记录。

#### **（5）CountyDemographics 表 (人口与就业)**

 **功能**: 记录县域的人口结构和社会保障情况，反映社会发展和人力资源状况。
 **关键字段**:
  county_id &year: 关联县域和时间。
  population_total: 总人口。
  urbanization_rate: 城镇化率。
  unemployment_rate: 失业率。
  migrant_workers: 外出务工人员数量。
  social_security_rate: 社会保障覆盖率。



```sql
-- 创建数据库
CREATE DATABASE poverty832_tracking;
USE poverty832_tracking;

-- 1. County 表
CREATE TABLE County (
    county_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    province VARCHAR(50) NOT NULL,
    UNIQUE(name, province)
);


-- 2. InfrastructureService 表
CREATE TABLE InfrastructureService (
    infra_id INT PRIMARY KEY AUTO_INCREMENT,
    county_id INT NOT NULL,
    year YEAR NOT NULL,
    pct_village_with_hard_road DECIMAL(5,2),
    pct_village_with_electricity DECIMAL(5,2),
    broadband_coverage DECIMAL(5,2),
    water_supply_coverage DECIMAL(5,2),
    sanitation_coverage DECIMAL(5,2),
    FOREIGN KEY (county_id) REFERENCES County(county_id)
);

-- 3. AgricultureSales 表
CREATE TABLE AgricultureSales (
    sale_id INT PRIMARY KEY AUTO_INCREMENT,
    county_id INT NOT NULL,
    year YEAR NOT NULL,
    product_type VARCHAR(100),
    sales_volume DECIMAL(18,2),
    sales_value DECIMAL(18,2),
    FOREIGN KEY (county_id) REFERENCES County(county_id)
);


-- 4. CountyEconomy（县域经济发展）
CREATE TABLE CountyEconomy (
    econ_id INT PRIMARY KEY AUTO_INCREMENT,
    county_id INT NOT NULL,
    year YEAR NOT NULL,
    
    gdp_total DECIMAL(18,2) COMMENT '年GDP (亿元)',
    fiscal_revenue DECIMAL(18,2) COMMENT '财政收入 (亿元)',
    per_capita_income DECIMAL(18,2) COMMENT '全体居民人均可支配收入 (元)',
    
    FOREIGN KEY (county_id) REFERENCES County(county_id),
    UNIQUE KEY uk_county_year (county_id, year) 
);

-- 5. CountyDemographics（人口与就业）
CREATE TABLE CountyDemographics (
    demo_id INT PRIMARY KEY AUTO_INCREMENT,
    county_id INT NOT NULL,
    year YEAR NOT NULL,
    population_total BIGINT,      
    urbanization_rate DECIMAL(5,2), 
    unemployment_rate DECIMAL(5,2), 
    migrant_workers BIGINT,        
    social_security_rate DECIMAL(5,2), 
    FOREIGN KEY (county_id) REFERENCES County(county_id)
);
```





### 2. 创建角色

#### （1）**admin（系统管理员）**

**权限**：拥有数据库的所有权限。

**适用场景**：系统整体维护与管理、权限管理、表结构更新。



#### （2）**data_entry（数据录入 / 调研员）**

**权限**：SELECT、INSERT、UPDATE，不允许删除表数据（DELETE），不允许修改表结构（ALTER）。

**适用场景**：数据采集、更新



#### （3）**analyst（数据分析者 / 研究员）**

**权限**：只允许查询数据，用于分析和研究，不允许插入（INSERT）、更新（UPDATE）、删除（DELETE）或修改表结构（ALTER）。

**适用场景**：数据统计与分析

```sql

-- 创建用户角色

CREATE USER 'admin'@'localhost' IDENTIFIED BY 'admin_pass';
CREATE USER 'data_entry'@'localhost' IDENTIFIED BY 'dataentry_pass';
CREATE USER 'analyst'@'localhost' IDENTIFIED BY 'analyst_pass';

-- 授权

-- admin: 所有权限
GRANT ALL PRIVILEGES ON poverty832_tracking.* TO 'admin'@'localhost';

-- data_entry: 插入 / 更新 / 查询
GRANT SELECT, INSERT, UPDATE ON poverty832_tracking.* TO 'data_entry'@'localhost';

-- analyst: 只读
GRANT SELECT ON poverty832_tracking.* TO 'analyst'@'localhost';

FLUSH PRIVILEGES;
```



## 二、数据获取和处理

### 1. County表

数据由文件直接导入

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120161517060.png" alt="image-20251120161517060" style="zoom:50%;" />

### 2. CountyEconomy表

首先爬虫获取数据，遍历贫困县名称，调用火山方舟（Doubao）大模型的 API 来获取每个县区的经济数据（GDP、财政收入、人均可支配收入），并将所有 API 返回的结果保存到一个新的 Excel 文件中

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120162039730.png" alt="image-20251120162039730" style="zoom:50%;" />

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120164246784.png" alt="image-20251120164246784" style="zoom:50%;" />

处理爬虫所得数据，地区名字仅仅保留县名，并与832个县匹配，最后导入CountyEconomy表

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120164315115.png" alt="image-20251120164315115" style="zoom:50%;" />

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120165945038.png" alt="image-20251120165945038" style="zoom:50%;" />

```sql
USE poverty832_tracking;

LOAD DATA INFILE 'D:\\ProgramData\\MySQL\\MySQL Server 8.0\\Uploads\\CountyEconomy_import_2024_completed.csv'
INTO TABLE CountyEconomy
CHARACTER SET utf8mb4
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(county_id, year, gdp_total, fiscal_revenue, per_capita_income);
```

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120170249993.png" alt="image-20251120170249993" style="zoom:50%;" />

### 3.其余表的数据随机生成

随机生成数据并导入数据库

<img src="E:\appfiles\typora_pic\832(4).assets\image-20251120181005573.png" alt="image-20251120181005573" style="zoom:50%;" />

```sql

LOAD DATA INFILE 'D:/ProgramData/MySQL/MySQL Server 8.0/Uploads/infrastructure_service_data_832.csv'
INTO TABLE InfrastructureService
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
IGNORE 1 ROWS
(
    county_id,
    year,
    pct_village_with_hard_road,
    pct_village_with_electricity,
    broadband_coverage,
    water_supply_coverage,
    sanitation_coverage
);
```

